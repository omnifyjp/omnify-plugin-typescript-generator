{"version":3,"sources":["../src/stubs.ts","../src/ai-guides/generator.ts"],"sourcesContent":["/**\n * Stub file utilities for React/Ant Design/TanStack Query utilities.\n * \n * NOTE: Stub files are NO LONGER generated into projects.\n * All runtime utilities should be imported from @famgia/omnify-client-react:\n * \n * ```typescript\n * import {\n *   // Components\n *   JapaneseNameField,\n *   JapaneseAddressField,\n *   JapaneseBankField,\n *   \n *   // Hooks\n *   useFormMutation,\n *   \n *   // Utilities\n *   zodRule,\n *   setZodLocale,\n *   kanaString,\n * } from '@famgia/omnify-client-react';\n * ```\n * \n * Only schema files (editable) and schema enums are generated into the project.\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\ninterface StubFile {\n  stub: string;\n  output: string;\n  indexExport: string;\n}\n\n/**\n * Stub file definitions - empty since all utilities come from @famgia/omnify-client-react\n */\nexport const STUB_FILES: readonly StubFile[] = [];\n\nexport interface CopyStubsOptions {\n  /** Target directory (e.g., 'resources/ts/omnify') */\n  targetDir: string;\n  /** Skip if file exists (default: false - always overwrite library files) */\n  skipIfExists?: boolean;\n}\n\nexport interface CopyStubsResult {\n  copied: string[];\n  skipped: string[];\n}\n\n/**\n * Copy React utility stubs to the target directory.\n *\n * @example\n * copyStubs({\n *   targetDir: 'resources/ts/omnify',\n *   skipIfExists: true,\n * });\n */\nexport function copyStubs(options: CopyStubsOptions): CopyStubsResult {\n  const { targetDir, skipIfExists = false } = options;\n  const stubsDir = path.join(__dirname, '..', 'stubs');\n  const result: CopyStubsResult = { copied: [], skipped: [] };\n\n  // Group stubs by directory for index file generation\n  const directories = new Map<string, string>();\n\n  for (const { stub, output, indexExport } of STUB_FILES) {\n    const stubPath = path.join(stubsDir, stub);\n    const outputPath = path.join(targetDir, output);\n    const outputDir = path.dirname(outputPath);\n    const dirName = path.dirname(output).split('/')[0]; // e.g., 'components', 'hooks', 'lib'\n\n    // Track index exports per directory\n    if (!directories.has(dirName)) {\n      directories.set(dirName, '');\n    }\n    directories.set(dirName, directories.get(dirName)! + indexExport);\n\n    // Create directory if not exists\n    if (!fs.existsSync(outputDir)) {\n      fs.mkdirSync(outputDir, { recursive: true });\n    }\n\n    // Skip if file exists and skipIfExists is true\n    if (skipIfExists && fs.existsSync(outputPath)) {\n      result.skipped.push(output);\n      continue;\n    }\n\n    // Copy stub file\n    if (fs.existsSync(stubPath)) {\n      const content = fs.readFileSync(stubPath, 'utf-8');\n      fs.writeFileSync(outputPath, content);\n      result.copied.push(output);\n    }\n  }\n\n  // Generate index files for each directory\n  for (const [dirName, exports] of directories) {\n    const indexPath = path.join(targetDir, dirName, 'index.ts');\n    if (skipIfExists && fs.existsSync(indexPath)) {\n      continue;\n    }\n    fs.writeFileSync(indexPath, exports);\n    result.copied.push(`${dirName}/index.ts`);\n  }\n\n  return result;\n}\n\n/**\n * Get list of stub files that would be generated.\n */\nexport function getStubPaths(): string[] {\n  return STUB_FILES.map(s => s.output);\n}\n","/**\n * AI Guides Generator for TypeScript/Frontend\n *\n * TypeScript/Reactプロジェクト用のAIガイド生成\n * @famgia/omnify-coreの統一ジェネレーターを使用\n */\n\nimport { existsSync, readdirSync } from 'node:fs';\nimport { resolve } from 'node:path';\nimport {\n    generateAIGuides as coreGenerateAIGuides,\n} from '@famgia/omnify-core';\n\n/**\n * Options for AI guides generation\n */\nexport interface AIGuidesOptions {\n    /**\n     * TypeScript output path from config (e.g., 'resources/ts/omnify')\n     * Used to extract the base path for glob replacement\n     */\n    typescriptPath?: string;\n\n    /**\n     * Base path for TypeScript files (default: extracted from typescriptPath or 'src')\n     * Used for placeholder replacement in Cursor rules\n     */\n    typescriptBasePath?: string;\n}\n\n/**\n * Result of AI guides generation\n */\nexport interface AIGuidesResult {\n    claudeGuides: number;\n    claudeChecklists: number;\n    cursorRules: number;\n    files: string[];\n}\n\n/**\n * Extract TypeScript base path from typescriptPath\n * e.g., 'resources/ts/omnify' -> 'resources/ts'\n * e.g., 'src/generated' -> 'src'\n */\nfunction extractTypescriptBasePath(typescriptPath?: string): string {\n    if (!typescriptPath) return 'src';\n\n    const normalized = typescriptPath.replace(/\\\\/g, '/');\n\n    // Remove last segment (omnify, generated, etc.)\n    const parts = normalized.split('/').filter(Boolean);\n    if (parts.length > 1) {\n        return parts.slice(0, -1).join('/');\n    }\n\n    return 'src';\n}\n\n/**\n * Generate AI guides for Claude and Cursor\n */\nexport function generateAIGuides(\n    rootDir: string,\n    options: AIGuidesOptions = {}\n): AIGuidesResult {\n    const basePath = options.typescriptBasePath || extractTypescriptBasePath(options.typescriptPath);\n\n    // Coreジェネレーターを呼び出し\n    const coreResult = coreGenerateAIGuides(rootDir, {\n        placeholders: {\n            TYPESCRIPT_BASE: basePath,\n            LARAVEL_BASE: 'app',\n            LARAVEL_ROOT: '',\n        },\n        // TypeScriptプロジェクトではReact関連のみ\n        adapters: ['cursor', 'claude'],\n    });\n\n    // 結果を変換 (後方互換性のため)\n    const result: AIGuidesResult = {\n        claudeGuides: 0,\n        claudeChecklists: 0,\n        cursorRules: 0,\n        files: coreResult.files,\n    };\n\n    // ファイル数をカウント\n    const claudeCount = coreResult.counts['claude'] || 0;\n    const cursorCount = coreResult.counts['cursor'] || 0;\n\n    result.claudeGuides = Math.floor(claudeCount * 0.8);\n    result.claudeChecklists = claudeCount - result.claudeGuides;\n    result.cursorRules = cursorCount;\n\n    return result;\n}\n\n/**\n * Check if AI guides need to be generated\n */\nexport function shouldGenerateAIGuides(rootDir: string): boolean {\n    const claudeDir = resolve(rootDir, '.claude/omnify/guides/react');\n    const cursorDir = resolve(rootDir, '.cursor/rules/omnify');\n\n    if (!existsSync(claudeDir) || !existsSync(cursorDir)) {\n        return true;\n    }\n\n    try {\n        const claudeFiles = readdirSync(claudeDir);\n        const cursorFiles = readdirSync(cursorDir);\n\n        return claudeFiles.length === 0 || cursorFiles.length === 0;\n    } catch {\n        return true;\n    }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,OAAO,QAAQ;AACf,OAAO,UAAU;AACjB,SAAS,qBAAqB;AAE9B,IAAM,aAAa,cAAc,YAAY,GAAG;AAChD,IAAM,YAAY,KAAK,QAAQ,UAAU;AAWlC,IAAM,aAAkC,CAAC;AAuBzC,SAAS,UAAU,SAA4C;AACpE,QAAM,EAAE,WAAW,eAAe,MAAM,IAAI;AAC5C,QAAM,WAAW,KAAK,KAAK,WAAW,MAAM,OAAO;AACnD,QAAM,SAA0B,EAAE,QAAQ,CAAC,GAAG,SAAS,CAAC,EAAE;AAG1D,QAAM,cAAc,oBAAI,IAAoB;AAE5C,aAAW,EAAE,MAAM,QAAQ,YAAY,KAAK,YAAY;AACtD,UAAM,WAAW,KAAK,KAAK,UAAU,IAAI;AACzC,UAAM,aAAa,KAAK,KAAK,WAAW,MAAM;AAC9C,UAAM,YAAY,KAAK,QAAQ,UAAU;AACzC,UAAM,UAAU,KAAK,QAAQ,MAAM,EAAE,MAAM,GAAG,EAAE,CAAC;AAGjD,QAAI,CAAC,YAAY,IAAI,OAAO,GAAG;AAC7B,kBAAY,IAAI,SAAS,EAAE;AAAA,IAC7B;AACA,gBAAY,IAAI,SAAS,YAAY,IAAI,OAAO,IAAK,WAAW;AAGhE,QAAI,CAAC,GAAG,WAAW,SAAS,GAAG;AAC7B,SAAG,UAAU,WAAW,EAAE,WAAW,KAAK,CAAC;AAAA,IAC7C;AAGA,QAAI,gBAAgB,GAAG,WAAW,UAAU,GAAG;AAC7C,aAAO,QAAQ,KAAK,MAAM;AAC1B;AAAA,IACF;AAGA,QAAI,GAAG,WAAW,QAAQ,GAAG;AAC3B,YAAM,UAAU,GAAG,aAAa,UAAU,OAAO;AACjD,SAAG,cAAc,YAAY,OAAO;AACpC,aAAO,OAAO,KAAK,MAAM;AAAA,IAC3B;AAAA,EACF;AAGA,aAAW,CAAC,SAAS,OAAO,KAAK,aAAa;AAC5C,UAAM,YAAY,KAAK,KAAK,WAAW,SAAS,UAAU;AAC1D,QAAI,gBAAgB,GAAG,WAAW,SAAS,GAAG;AAC5C;AAAA,IACF;AACA,OAAG,cAAc,WAAW,OAAO;AACnC,WAAO,OAAO,KAAK,GAAG,OAAO,WAAW;AAAA,EAC1C;AAEA,SAAO;AACT;AAKO,SAAS,eAAyB;AACvC,SAAO,WAAW,IAAI,OAAK,EAAE,MAAM;AACrC;;;ACnHA,SAAS,YAAY,mBAAmB;AACxC,SAAS,eAAe;AACxB;AAAA,EACI,oBAAoB;AAAA,OACjB;AAkCP,SAAS,0BAA0B,gBAAiC;AAChE,MAAI,CAAC,eAAgB,QAAO;AAE5B,QAAM,aAAa,eAAe,QAAQ,OAAO,GAAG;AAGpD,QAAM,QAAQ,WAAW,MAAM,GAAG,EAAE,OAAO,OAAO;AAClD,MAAI,MAAM,SAAS,GAAG;AAClB,WAAO,MAAM,MAAM,GAAG,EAAE,EAAE,KAAK,GAAG;AAAA,EACtC;AAEA,SAAO;AACX;AAKO,SAAS,iBACZ,SACA,UAA2B,CAAC,GACd;AACd,QAAM,WAAW,QAAQ,sBAAsB,0BAA0B,QAAQ,cAAc;AAG/F,QAAM,aAAa,qBAAqB,SAAS;AAAA,IAC7C,cAAc;AAAA,MACV,iBAAiB;AAAA,MACjB,cAAc;AAAA,MACd,cAAc;AAAA,IAClB;AAAA;AAAA,IAEA,UAAU,CAAC,UAAU,QAAQ;AAAA,EACjC,CAAC;AAGD,QAAM,SAAyB;AAAA,IAC3B,cAAc;AAAA,IACd,kBAAkB;AAAA,IAClB,aAAa;AAAA,IACb,OAAO,WAAW;AAAA,EACtB;AAGA,QAAM,cAAc,WAAW,OAAO,QAAQ,KAAK;AACnD,QAAM,cAAc,WAAW,OAAO,QAAQ,KAAK;AAEnD,SAAO,eAAe,KAAK,MAAM,cAAc,GAAG;AAClD,SAAO,mBAAmB,cAAc,OAAO;AAC/C,SAAO,cAAc;AAErB,SAAO;AACX;AAKO,SAAS,uBAAuB,SAA0B;AAC7D,QAAM,YAAY,QAAQ,SAAS,6BAA6B;AAChE,QAAM,YAAY,QAAQ,SAAS,sBAAsB;AAEzD,MAAI,CAAC,WAAW,SAAS,KAAK,CAAC,WAAW,SAAS,GAAG;AAClD,WAAO;AAAA,EACX;AAEA,MAAI;AACA,UAAM,cAAc,YAAY,SAAS;AACzC,UAAM,cAAc,YAAY,SAAS;AAEzC,WAAO,YAAY,WAAW,KAAK,YAAY,WAAW;AAAA,EAC9D,QAAQ;AACJ,WAAO;AAAA,EACX;AACJ;","names":[]}